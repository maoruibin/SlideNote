# SlideNote Markdown 编辑器优化 产品需求文档 (PRD)

> **版本**: v0.0.2
> **创建日期**: 2025-01-13
> **状态**: 设计中
> **产品经理**: Claude

---

## 一、功能概述

### 1.1 用户痛点

> *"我想在笔记里做一些简单的格式化，比如加粗、列表、链接，但现在的纯文本编辑器不支持"*

> *"复制到微信/邮件时，希望保留格式，而不是复制一堆 **星号**"*

当前 SlideNote 的纯文本编辑器无法满足用户对格式化的基本需求：
1. **无格式支持** - 加粗、斜体、列表等基础格式无法实现
2. **复制体验差** - 复制到其他应用时带星号等 Markdown 符号，不美观
3. **迁移受限** - 想把笔记复制到 Notion/Obsidian 等应用时，需要手动处理格式

### 1.2 产品目标

**核心目标**：提供简单好用的 Markdown 格式化能力，同时保持"简单至上"的产品原则

| 目标 | 衡量标准 |
|------|----------|
| 格式化体验 | 支持最常用的 9 种 Markdown 语法 |
| 复制体验 | 默认复制带格式，可选复制源码 |
| 保持简单 | 不增加工具栏，不破坏现有体验 |

### 1.3 设计原则

1. **简单优先** - 只支持最常用的 Markdown 语法，不做复杂功能
2. **渐进增强** - 现有功能不受影响，Markdown 是可选能力
3. **存储透明** - 始终存储 Markdown 源码，用户可随时查看
4. **复制友好** - 复制时智能判断，默认带格式

---

## 二、功能需求

### 2.1 功能边界

**✅ v0.0.2 包含（MVP）**：

| 功能 | 说明 | 优先级 | 复杂度 |
|------|------|--------|--------|
| Markdown 实时渲染 | 输入语法后自动转换为格式化显示 | P0 | 中 |
| 富文本复制 | 默认复制带格式（HTML） | P0 | 低 |
| 复制为 Markdown | 右上角菜单，复制源码 | P0 | 低 |
| 语法高亮提示 | Markdown 符号半透明显示 | P1 | 低 |
| 编辑器更多菜单 | 右上角 [⋮] 菜单，扩展功能入口 | P0 | 低 |

**✅ 支持的 Markdown 语法（v0.0.2）**：

| 语法 | 示例 | 渲染效果 |
|------|------|----------|
| 标题 | `# 一级标题` | 大号加粗 |
| 加粗 | `**粗体**` | **粗体** |
| 斜体 | `*斜体*` | *斜体* |
| 链接 | `[文本](url)` | [可点击链接] |
| 行内代码 | `` `代码` `` | `灰色背景代码` |
| 代码块 | ` ```代码``` ` | 灰色背景代码块 |
| 列表 | `- 项目` | • 项目 |
| 引用 | `> 引用` | 左侧竖线+灰色背景 |
| 分割线 | `---` | 横线 |

**❌ 本版本不包含**：

- 任务列表 `- [ ]`
- 表格
- 图片
- 工具栏按钮
- 语法高亮（代码块内无颜色）

### 2.2 用户交互流程

```
编辑流程（所见即所得）
────────────────────
用户输入: **这是粗体**
    ↓
输入空格或触发字符后
    ↓
自动渲染为: **这是粗体**（粗体样式，**半透明显示**）
    ↓
用户继续输入...

复制流程（智能判断）
────────────────────
用户选中文本，按 Ctrl/Cmd + C
    ↓
默认行为：复制为富文本（保留格式）
    ↓
粘贴到微信/邮件时，格式保留

复制源码流程
────────────────────
用户点击右上角 [⋮] → "复制为 Markdown"
    ↓
复制当前笔记的 Markdown 源码
    ↓
可粘贴到代码编辑器、GitHub 等
```

---

## 三、交互设计

### 3.1 编辑器渲染方案

**✅ 已确定：方案 B（样式提示）**

| 方案 | 优点 | 缺点 | 选择 |
|------|------|------|------|
| A. 实时渲染 | 完全所见即所得，体验最佳 | 实现复杂，需处理编辑状态 | ❌ |
| B. 样式提示 | Markdown 符号半透明，简单可靠 | 不是真正的所见即所得 | ✅ |

**渲染示意**：

```
输入:       **这是粗体**
显示:       **这是粗体**
            ↑ 半透明显示  ↑ 正常显示  ↑ 半透明显示

类似 Bear、Notion 的体验，Markdown 符号变淡但不消失
```

### 3.2 编辑器更多菜单 [⋮]

**位置：编辑器右上角**

```
┌─────────────────────────────────────────────┐
│  常用账号                               [⋮] │
│  ─────────────────────────────────────────  │
│                                             │
│  Gmail: xxx@gmail.com                       │
│  密码: ******                               │
│                                             │
│  [✓ 已保存]              3 分钟前          │
└─────────────────────────────────────────────┘
                              ↑
                           更多菜单
```

**点击 [⋮] 展开菜单**：

```
┌──────────────────────────────┐
│ 📋 复制为 Markdown            │
│ 📤 分享笔记（未来版本）        │
│ ─────────────────────────    │
│ ℹ️  Markdown 语法快捷键提示    │
└──────────────────────────────┘
```

**菜单功能说明**：

| 功能 | 说明 | 版本 |
|------|------|------|
| 📋 复制为 Markdown | 复制整条笔记的 Markdown 源码 | v0.0.2 |
| 📤 分享笔记 | 生成分享链接/二维码（未来） | v0.0.3+ |
| ℹ️ 语法快捷键提示 | 显示 Markdown 语法说明 | v0.0.2 |

**点击「复制为 Markdown」后弹出确认提示**：

```
┌─────────────────────────────────┐
│  ✓ 已复制 Markdown 源码到剪贴板  │
└─────────────────────────────────┘
位置: 按钮下方
时长: 2 秒后自动消失
```

**点击「语法快捷键提示」后弹出**：

```
┌─────────────────────────────────────────────┐
│  Markdown 语法提示                      [×]  │
├─────────────────────────────────────────────┤
│                                             │
│  格式        语法          效果             │
│  ─────────────────────────────────────      │
│  粗体        **文本**      **粗体**         │
│  斜体        *文本*        *斜体*           │
│  行内代码    `代码`        `代码`           │
│  链接        [文本](网址)  [链接]           │
│  标题        # 标题       大号文字          │
│  列表        - 项目        • 项目           │
│  引用        > 引用       带边框引用        │
│                                             │
└─────────────────────────────────────────────┘
```

### 3.3 样式规范

**Markdown 符号样式（方案 B）**：

```css
/* Markdown 分隔符半透明 */
.md-delimiter {
  color: var(--color-text-secondary);
  opacity: 0.3;
}

/* 渲染后的样式 */
.md-bold { font-weight: 600; }
.md-italic { font-style: italic; }
.md-code {
  background: var(--color-bg-secondary);
  padding: 2px 4px;
  border-radius: 3px;
  font-family: monospace;
  font-size: 0.9em;
}
```

---

## 四、产品分析：编辑器菜单设计

### 4.1 从产品经理角度的思考

**右上角 [⋮] 菜单是编辑器功能的"战略入口"**

随着产品发展，编辑器需要的功能会越来越多。现在设计好这个入口，未来可以自然扩展，而不会让界面变得杂乱。

### 4.2 菜单功能规划（分版本）

| 版本 | 功能 | 优先级 | 用户价值 |
|------|------|--------|----------|
| v0.0.2 | 📋 复制为 Markdown | P0 | 满足开发者复制源码需求 |
| v0.0.2 | ℹ️ 语法快捷键提示 | P1 | 降低 Markdown 学习成本 |
| v0.0.3 | 📤 分享笔记 | P1 | 团队协作场景 |
| v0.0.3 | 📊 字数统计 | P2 | 写作场景 |
| v0.0.4 | 🔍 查找替换 | P1 | 长文本编辑 |
| 未来 | ⚙️ 编辑器设置 | P2 | 个性化（字体大小等） |
| 未来 | 🌙 预览模式 | P2 | 阅读体验 |

### 4.3 为什么这样设计？

1. **用户心智模型**：[⋮] = 更多选项，这是行业标准模式
2. **扩展性**：未来有新功能不需要改界面布局
3. **简洁性**：常用功能放在显眼位置，高级功能藏在菜单里
4. **一致性**：与笔记列表的 [⋮] 菜单形成统一语言

### 4.4 与其他产品的对比

| 产品 | 编辑器菜单入口 | 我们可以借鉴的 |
|------|---------------|----------------|
| **Notion** | 顶部工具栏 + / 命令面板 | 工具栏简洁，高级功能折叠 |
| **Obsidian** | 右侧信息面板 | 信息密度高，功能分组 |
| **飞书文档** | 顶部工具栏 + 更多菜单 | 「更多」里放不常用功能 |
| **微信读书笔记** | 分享按钮入口 | 复制/分享功能集中 |

**我们的差异化**：
- 比通用文档编辑器更简单（只有 2-3 个菜单项）
- 菜单项都是"单次触发"类型，没有设置开关
- 不做工具栏，保持极简

---

## 五、需求完备性分析

### 5.1 当前需求覆盖情况

| 用户需求 | 是否覆盖 | 实现方式 |
|----------|----------|----------|
| 基础格式化 | ✅ | 9 种 Markdown 语法 |
| 复制带格式 | ✅ | 默认富文本复制 |
| 复制源码 | ✅ | 菜单「复制为 Markdown」 |
| 学习成本 | ✅ | 菜单「语法提示」 |
| 数据安全 | ✅ | 源码存储，随时可查看 |
| 性能 | ✅ | 轻量实现，< 50ms 渲染 |

### 5.2 可能遗漏的需求（待讨论）

| 需求 | 是否需要 | 说明 |
|------|----------|------|
| 快捷键支持 | ❓ | Ctrl+B 加粗、Ctrl+K 链接等 |
| 撤销/重做增强 | ❓ | contenteditable 默认支持，但可能需要优化 |
| 选中文本快捷格式化 | ❓ | 选中文本后弹出浮动工具栏 |
| 拼写检查 | ❓ | 浏览器自带，但可能需要开关 |
| 自动补全 | ❓ | 输入 `*` 后提示配对 |

### 5.3 边界情况考虑

| 场景 | 处理方式 | 优先级 |
|------|----------|--------|
| 用户输入超大文本（>10000 字） | 虚拟滚动或分页 | P1 |
| 不完整的 Markdown 语法（如只有一个 `*`） | 保持原样，不渲染 | P0 |
| 混合中英文输入 | 统一样式处理 | P0 |
| 移动端小屏幕 | 响应式调整菜单位置 | P1 |

### 5.4 建议补充的功能

考虑到产品"简单至上"的原则，以下功能建议在 v0.0.3 或之后考虑：

1. **快捷键支持**（v0.0.3）
   - Ctrl/Cmd + B：加粗
   - Ctrl/Cmd + I：斜体
   - Ctrl/Cmd + K：插入链接

2. **字数统计**（v0.0.3）
   - 显示在编辑器底部状态栏
   - 实时更新

3. **查找替换**（v0.0.4）
   - 通过菜单入口触发
   - 轻量级实现

---

## 六、技术方案

### 6.1 数据存储

**存储格式**：始终保持 Markdown 源码存储

```javascript
// Chrome Storage 中存储的格式
{
  id: "note_123",
  title: "常用账号",
  content: "Gmail: xxx@gmail.com\n密码: ******",  // 纯 Markdown 文本
  // 不存储渲染后的 HTML
}
```

### 6.2 核心实现方案（样式提示）

**关键思路**：使用 `<div contenteditable="plaintext-only">` + 实时样式解析

```javascript
class MarkdownEditor {
  constructor() {
    this.element = document.createElement('div');
    this.element.contentEditable = 'plaintext-only';
    this.element.className = 'markdown-editor';
  }

  onInput() {
    this.applyMarkdownStyles();
  }
}
```

### 6.3 复制功能实现

**富文本复制**：

```javascript
document.addEventListener('copy', (e) => {
  const selection = window.getSelection();
  const html = getRenderedHTML(selection);
  e.clipboardData.setData('text/html', html);
  e.clipboardData.setData('text/plain', selection.toString());
});
```

**复制 Markdown 源码**：

```javascript
function copyMarkdown() {
  const markdown = getMarkdownSource();
  navigator.clipboard.writeText(markdown);
  showToast('已复制 Markdown 源码');
}
```

---

## 七、文件修改清单

| 文件 | 修改内容 | 优先级 |
|------|----------|--------|
| `src/sidepanel/components/NoteEditor.js` | 替换 textarea 为 Markdown 编辑器 | P0 |
| `src/sidepanel/styles.css` | 添加 Markdown 样式 | P0 |
| `src/sidepanel/utils/markdown.js` | Markdown 解析和渲染工具 | P0 |
| `src/sidepanel/utils/clipboard.js` | 复制功能封装 | P0 |

---

## 八、风险评估

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| contenteditable 兼容性问题 | 中 | 中 | 充分测试，降级方案 |
| 渲染性能问题 | 中 | 低 | 防抖处理 |
| 用户不熟悉 Markdown | 低 | 高 | 提供语法提示 |
| 破坏现有数据 | 高 | 低 | 保留源码存储 |

---

## 九、版本规划

### Phase 1：MVP（v0.0.2）

- [ ] Markdown 实时渲染（9 种语法）
- [ ] 富文本复制
- [ ] 复制为 Markdown 菜单项
- [ ] 语法快捷键提示
- [ ] Markdown 符号半透明样式

### Phase 2：增强（v0.0.3）

- [ ] 快捷键支持（Ctrl+B 加粗等）
- [ ] 分享笔记功能
- [ ] 字数统计

---

## 十、附录

### 10.1 参考资料

- [How I Built a Markdown Editor in Vanilla JavaScript](https://javascript.plainenglish.io/how-i-built-a-markdown-editor-in-vanilla-javascript-live-preview-included-350dd8066873)
- [contenteditable plaintext-only attribute](https://web.dev/blog/contenteditable-plaintext-only-baseline)
- [Stack Overflow: Insert markdown in contenteditable](https://stackoverflow.com/questions/70352215/how-to-insert-markdown-formatting-inside-a-contenteditable-div)

### 10.2 已确认设计决策

| 决策项 | 选择 | 理由 |
|--------|------|------|
| 编辑方式 | 方案 B：样式提示 | 简单可靠，实现复杂度低 |
| 复制菜单 | 下拉菜单 [⋮] | 统一入口，未来可扩展更多功能 |
| 语法范围 | 9 种基础语法 | 覆盖 90% 日常需求，保持简单 |

### 10.3 变更记录

| 日期 | 版本 | 变更内容 | 负责人 |
|------|------|----------|--------|
| 2025-01-13 | v0.0.2 | 初始版本 | Claude |
