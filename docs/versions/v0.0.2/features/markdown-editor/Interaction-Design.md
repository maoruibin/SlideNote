# Markdown 编辑器交互设计文档

## 概述

SlideNote 的 Markdown 编辑器采用"预览优先"的设计理念，默认展示渲染效果，提供阅读体验。用户可以快速切换到编辑模式进行修改。

## 核心交互

### 1. 模式切换

```
┌─────────────────────────────────────────────────────┐
│  笔记标题              [✏️ 编辑] [⋮ 更多]           │  ← 预览模式
├─────────────────────────────────────────────────────┤
│  这是渲染后的内容，用户可以阅读和选择复制          │
│  **粗体** *斜体* `代码` 都会显示样式               │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  笔记标题              [👁️ 预览] [⋮ 更多]          │  ← 编辑模式
├─────────────────────────────────────────────────────┤
│  这是纯文本 Markdown 源码                           │
│  **粗体** *斜体* `代码`                              │
└─────────────────────────────────────────────────────┘
```

### 2. 交互规则

| 操作 | 预览模式 | 编辑模式 |
|------|----------|----------|
| 点击文本区域 | 无响应（可复制选择） | 可编辑 |
| 点击编辑/预览按钮 | 进入编辑模式 | 进入预览模式 |
| ESC 键 | 无操作 | 返回预览模式 |
| Ctrl/Cmd + E | 进入编辑模式 | 返回预览模式 |

### 3. 状态记忆

每个笔记独立记录其显示模式，存储在 `chrome.storage.local`：

```javascript
{
  "noteViewMode": {
    "note_123": "preview",  // 预览模式
    "note_456": "edit"      // 编辑模式
  }
}
```

**规则**：
- 切换笔记时，根据保存的状态恢复显示模式
- 新建笔记默认进入编辑模式（因为内容为空）
- 每次切换模式时自动保存状态

### 4. 复制功能

在预览模式下，更多菜单提供两种复制方式：

| 选项 | 功能 |
|------|------|
| 复制为富文本 | 复制带样式的内容，可粘贴到 Word/邮件 |
| 复制为 Markdown | 复制源码，可粘贴到其他 Markdown 编辑器 |

### 5. 语法帮助

点击"语法快捷键提示"打开居中对话框：

```
┌─────────────────────────────────────────────┐
│           Markdown 语法帮助                  │
├─────────────────────────────────────────────┤
│                                             │
│  Markdown 是一种轻量级标记语言，             │
│  让你用纯文本格式编写内容。                   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ **粗体**     *斜体*     `代码`      │   │
│  │ # 标题       - 列表      > 引用     │   │
│  │ [链接](url)  ```代码块```           │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [了解更多关于 Markdown →]                  │
│                                             │
│                           [关闭]            │
└─────────────────────────────────────────────┘
```

## 技术实现

### 组件
- `NoteEditor.js` - 主编辑器组件，处理模式切换和状态记忆
- `EditorMoreMenu.js` - 更多菜单，包含复制功能
- `SyntaxHelpModal.js` - 语法帮助对话框

### 存储
- 使用 `chrome.storage.local` 存储笔记显示模式
- 使用 `marked.js` 渲染 Markdown

### 样式
- 预览层：`.markdown-preview-layer`
- 编辑层：`.note-content-textarea`
- 按钮状态：`.btn-edit` / `.btn-edit.active`

## 设计原则

1. **预览优先** - 默认展示渲染效果，符合笔记应用的阅读属性
2. **状态记忆** - 每个笔记记住用户的偏好
3. **简洁交互** - 单一按钮完成模式切换
4. **原生体验** - 使用系统复制，不干扰用户习惯
