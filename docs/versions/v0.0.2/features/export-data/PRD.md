# 数据导出功能 产品需求文档 (PRD)

> **版本**: v0.0.2
> **创建日期**: 2025-01-12
> **状态**: 设计中
> **产品经理**: Claude

---

## 一、功能概述

### 1.1 用户痛点

> *"我的笔记都存在插件里，万一哪天浏览器崩溃或者换电脑了，数据怎么办？"*

用户对存储在云端/浏览器中的数据天然存在不安全感：
1. **数据丢失焦虑** - 浏览器重装、插件卸载、账号切换都可能导致数据丢失
2. **迁移成本高** - 想换其他笔记应用时，只能一条条复制粘贴
3. **缺乏控制感** - 用户看不到、摸不着自己的数据

### 1.2 产品目标

**核心目标**：让用户对自己的数据拥有完全的控制权

| 目标 | 衡量标准 |
|------|----------|
| 数据安全感 | 用户知道可以随时导出备份 |
| 迁移便利性 | 导出格式兼容主流笔记应用 |
| 操作简洁性 | 3 次点击完成导出 |

### 1.3 设计原则

1. **数据主权优先** - 用户的数据，用户说了算
2. **格式开放通用** - JSON 可读，Markdown 可用
3. **操作极简无脑** - 不需要思考，点击即导出
4. **失败友好提示** - 出错了也要告诉用户为什么

---

## 二、用户与场景

### 2.1 目标用户

| 用户类型 | 典型诉求 | 使用频率 |
|----------|----------|----------|
| **谨慎型用户** | 定期备份，怕数据丢失 | 每月 1-2 次 |
| **迁移型用户** | 想换到其他笔记应用 | 一次性 |
| **整理型用户** | 把笔记导出到本地归档 | 每季度 1 次 |

### 2.2 核心场景

```
场景 1：定期备份党
─────────────────────────────
用户："我存了好多重要信息，还是定期备份一下吧"
操作：点击 → 选择 JSON → 导出
结果：心里踏实了

场景 2：换电脑/重装浏览器
─────────────────────────────
用户："要换新电脑了，先把笔记导出来"
操作：点击 → 选择 JSON（包含归档）→ 导出
结果：新电脑上可以恢复（注：恢复功能 v0.0.3）

场景 3：迁移到 Obsidian/Notion
─────────────────────────────
用户："Obsidian 看起来不错，想迁移过去试试"
操作：点击 → 选择 Markdown → 导出全部
结果：复制到 Obsidian 目录即可使用

场景 4：分享单条笔记
─────────────────────────────
用户："这个 API 配置想发给同事"
操作：右键笔记 → 导出为 Markdown
结果：得到 .md 文件，可以发送给任何人
```

---

## 三、功能需求

### 3.1 功能边界

**✅ v0.0.2 包含（MVP）**：

| 功能 | 用户价值 | 优先级 | 复杂度 |
|------|----------|--------|--------|
| 一键导出全部为 JSON | 完整备份，数据安心 | P0 | 低 |
| 一键导出全部为 Markdown | 迁移到其他笔记应用 | P0 | 低 |
| 导出单条为 Markdown | 快速分享某条笔记 | P0 | 低 |
| 文件自动命名 | 无需思考，开箱即用 | P0 | 低 |
| 导出进度提示 | 知道正在处理 | P0 | 低 |

**✅ v0.0.3 考虑（延后）**：

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 导入 JSON 恢复数据 | 让导出真正有意义 | P0 |
| 导出选中笔记 | 批量导出特定几条 | P1 |
| 自动备份提醒 | 每月提醒一次 | P2 |

**❌ 不做**：

- 导出为 PDF/HTML → 太复杂，需求弱
- 云端备份集成 → 违背"简单"原则
- 加密导出 → 增加复杂度，需求不明确

### 3.2 用户交互流程

```
流程 A：导出全部笔记（最常用）
─────────────────────────────────
点击笔记列表底部 ⋮ 菜单
    ↓
点击 "导出笔记"
    ↓
选择格式：JSON | Markdown
    ↓
浏览器自动下载文件
    ↓
完成提示 "导出成功，文件已保存到下载文件夹"

流程 B：导出单条笔记
─────────────────────────────────
右键点击笔记列表项
    ↓
点击 "导出为 Markdown"
    ↓
浏览器自动下载 {笔记标题}.md
    ↓
完成提示
```

---

## 四、交互设计

### 4.1 入口位置

**方案 A：底部工具栏（推荐）**

```
┌─────────────────────────────────────────┐
│  笔记列表                               │
│                                         │
│  ─────────────────────────────────      │
│                                         │
│  [+ 新建]    [⋮ 更多]                   │
│              ↑ 导出笔记入口              │
└─────────────────────────────────────────┘
```

点击 [⋮ 更多] 展开菜单：
```
┌──────────────┐
│ 📤 导出笔记  │
│ ⚙️ 设置      │
│ 📊 存储空间  │
└──────────────┘
```

**理由**：
- 入口统一，未来可扩展更多功能
- 不占用视觉空间
- 符合用户对"更多功能"的认知模型

### 4.2 导出选择对话框

```
┌─────────────────────────────────────────────┐
│  导出笔记                              [×]  │
├─────────────────────────────────────────────┤
│                                             │
│  选择导出格式                               │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  📦 JSON                             │   │
│  │  完整备份，包含所有元数据，适合恢复   │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  📝 Markdown                         │   │
│  │  可读性强，适合查看和迁移到其他应用   │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ☑ 包含归档笔记（共 3 条归档笔记）          │
│                                             │
│  ┌─────────────────┐  ┌─────────────────┐ │
│  │   取消           │  │   导出           │ │
│  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────┘

宽度: 400px
选中项: 蓝色边框 + 浅蓝背景
```

**交互细节**：
- 默认选中 JSON（最常用场景）
- 选项卡片化，描述清晰，降低理解成本
- 归档笔记数量动态显示，让用户心中有数
- 取消和导出按钮右对齐，符合常规操作习惯

### 4.3 导出进度与反馈

**导出中**：
```
┌─────────────────────────────────┐
│  ⏳ 正在导出...                  │
│  准备数据中                      │
└─────────────────────────────────┘
```

**导出成功**（Toast 提示）：
```
┌─────────────────────────────────┐
│  ✓ 导出成功                      │
│  文件已保存到下载文件夹           │
└─────────────────────────────────┘
位置: 右下角
时长: 3 秒后自动消失
```

**导出失败**（Toast 提示）：
```
┌─────────────────────────────────┐
│  ✗ 导出失败                      │
│  {错误原因}                      │
└─────────────────────────────────┘
```

### 4.4 空状态处理

```
┌─────────────────────────────────────────────┐
│  导出笔记                              [×]  │
├─────────────────────────────────────────────┤
│                                             │
│              📭                              │
│                                             │
│          还没有笔记                          │
│                                             │
│     先创建一些笔记，再来导出吧               │
│                                             │
│  ┌─────────────────┐                       │
│  │        知道了       │                       │
│  └─────────────────┘                       │
└─────────────────────────────────────────────┘
```

---

## 五、数据格式设计

### 5.1 JSON 格式（完整备份）

```json
{
  "_meta": {
    "version": "0.0.2",
    "exportedAt": "2025-01-12T10:30:00.000Z",
    "exportedBy": "SlideNote Chrome Extension"
  },
  "data": {
    "notes": [
      {
        "id": "note_1704965400000_abc123",
        "title": "常用账号",
        "content": "Gmail: xxx@gmail.com\n密码: ******",
        "createdAt": "2025-01-10T08:00:00.000Z",
        "updatedAt": "2025-01-11T10:30:00.000Z"
      }
    ],
    "activeNoteId": "note_1704965400000_abc123"
  },
  "archived": [
    {
      "id": "note_1704879000000_def456",
      "title": "旧项目配置",
      "content": "...",
      "createdAt": "2024-12-15T09:00:00.000Z",
      "updatedAt": "2024-12-20T14:00:00.000Z",
      "archivedAt": "2025-01-01T00:00:00.000Z"
    }
  ]
}
```

**设计要点**：
- `_meta` 前缀避免与用户数据冲突
- 结构扁平，便于解析和恢复
- 时间使用 ISO 8601 格式，跨语言兼容

### 5.2 Markdown 格式（单条笔记）

```markdown
# 常用账号

> 创建于 2025-01-10 | 最后编辑 2025-01-11

Gmail: xxx@gmail.com
密码: ******

---

*导出自 SlideNote (slidenote.app)*
```

**设计要点**：
- 时间信息用引用块，视觉清晰
- 底部添加来源标识，方便追溯
- 标题使用 H1，兼容性强

### 5.3 Markdown 格式（全部笔记合并）

```markdown
# SlideNote 笔记备份

> 导出时间：2025-01-12 10:30
> 笔记数量：3 条

---

## 常用账号

> 创建于 2025-01-10 | 最后编辑 2025-01-11

Gmail: xxx@gmail.com
密码: ******

---

## API Keys

> 创建于 2025-01-09 | 最后编辑 2025-01-09

OpenAI: sk-xxxx

---

*导出自 SlideNote (slidenote.app) • 备份时间：2025-01-12*
```

### 5.4 文件命名规则

| 导出类型 | 文件名格式 | 示例 |
|----------|-----------|------|
| JSON 全部 | `SlideNote-Backup-YYYY-MM-DD.json` | `SlideNote-Backup-2025-01-12.json` |
| MD 全部 | `SlideNote-Notes-YYYY-MM-DD.md` | `SlideNote-Notes-2025-01-12.md` |
| MD 单条 | `{标题}.md` 或 `Untitled-{id}.md` | `常用账号.md` |

**命名要点**：
- 使用英文前缀，避免文件编码问题
- 日期格式使用 ISO (YYYY-MM-DD)，全球通用
- 单条笔记标题中的特殊字符自动替换为 `-`

---

## 六、错误处理与边界情况

### 6.1 错误场景

| 场景 | 处理方式 | 提示文案 |
|------|----------|----------|
| 没有笔记 | 禁用导出按钮 / 显示空状态 | "还没有笔记可导出" |
| 导出过程中用户关闭对话框 | 继续后台导出 + Toast 提示 | "导出完成，文件已保存" |
| 浏览器阻止下载 | 显示引导说明 | "请允许浏览器下载文件" |
| 数据过大导致超时 | 显示进度 + 可取消 | "正在处理，预计还需 X 秒..." |
| JSON 序列化失败 | 记录错误日志 + 用户提示 | "导出失败，请重试或联系支持" |

### 6.2 特殊字符处理

| 内容类型 | 处理规则 |
|----------|----------|
| 笔记标题（文件名） | 移除 `/ \ : * ? " < > \| \x00-\x1f`，超长截断 |
| 笔记内容（JSON） | JSON.stringify 自动转义 |
| 笔记内容（Markdown） | 保持原样，用户负责内容安全 |

---

## 七、非功能需求

### 7.1 性能要求

| 指标 | 要求 | 说明 |
|------|------|------|
| 导出响应时间 | < 500ms | 点击到开始下载 |
| 大文件导出 | 1000 条笔记 < 5s | 超过显示进度提示 |
| 文件大小准确 | 误差 < 1% | 与实际存储大小一致 |

### 7.2 兼容性要求

| 平台 | 要求 |
|------|------|
| Chrome | ≥ 88 (支持 Blob API) |
| Edge | ≥ 88 (Chromium 内核) |
| 文件系统 | 支持 UTF-8 编码文件名 |

### 7.3 安全与隐私

| 要求 | 实现方式 |
|------|----------|
| 数据本地处理 | 不经过任何服务器 |
| 文件下载权限 | 浏览器标准下载流程 |
| 敏感内容 | 原样导出，不做额外处理 |

---

## 八、数据指标

### 8.1 成功指标

| 指标 | 目标值 | 统计方式 |
|------|--------|----------|
| 导出功能可用率 | > 99.9% | 失败次数 / 总导出次数 |
| 月活跃使用率 | > 15% | 月导出用户 / 月活跃用户 |
| 平均导出次数 | 0.5 次/用户/月 | 总导出次数 / 活跃用户 |

### 8.2 埋点设计

```javascript
// 事件埋点
track('export_dialog_opened', { source: 'toolbar_menu' })
track('export_format_selected', { format: 'json' })
track('export_completed', {
  format: 'json',
  noteCount: 10,
  includeArchived: true,
  duration: 230 // ms
})
track('export_failed', { error: 'blob_error' })
```

---

## 九、版本规划

### Phase 1：MVP（v0.0.2）

- [x] 导出全部为 JSON
- [x] 导出全部为 Markdown
- [x] 导出单条为 Markdown
- [x] 导出对话框 UI
- [x] 包含归档笔记选项

### Phase 2：增强（v0.0.3）

- [ ] 导入 JSON 恢复数据
- [ ] 导出选中笔记
- [ ] 自动备份提醒

---

## 十、风险评估

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 浏览器下载被阻止 | 高 | 中 | 提示用户允许下载 |
| 文件名编码问题 | 中 | 低 | 使用英文前缀 |
| 大数据量性能问题 | 中 | 低 | 分批处理 + 进度提示 |
| 用户导出后找不到文件 | 低 | 高 | 明确提示"已保存到下载文件夹" |

---

## 十一、竞争分析

| 产品 | 导出方式 | 优点 | 我们可以借鉴的 |
|------|----------|------|----------------|
| **Notion** | HTML/Markdown/CSV | 格式丰富，可选范围 | 导出格式描述清晰 |
| **Obsidian** | Markdown + 附件 | 原生格式，无缝切换 | 单条笔记导出 |
| **Flomo** | JSON 备份 | 简单直接 | 一键备份 |
| **微信读书笔记** | 复制到剪贴板 | 操作简单 | 考虑快捷方式 |

**我们的差异化**：
- 比 Notion 简单，不需要选择太多
- 比 Obsidian 轻量，不需要文件夹管理
- 比通用备忘录专业，支持完整数据备份

---

## 十二、附录

### 12.1 文件大小估算

| 笔记数 | 平均内容长度 | JSON 大小 | MD 大小 |
|--------|-------------|-----------|---------|
| 10 条 | 500 字 | ~8KB | ~6KB |
| 50 条 | 500 字 | ~35KB | ~25KB |
| 100 条 | 500 字 | ~70KB | ~50KB |

### 12.2 术语表

| 术语 | 说明 |
|------|------|
| JSON | JavaScript Object Notation，轻量级数据交换格式 |
| Markdown | 轻量级标记语言，可用文本编辑器编辑 |
| Blob | Binary Large Object，浏览器二进制大对象 |
| 归档笔记 | 已移至本地存储的历史笔记 |

### 12.3 变更记录

| 日期 | 版本 | 变更内容 | 负责人 |
|------|------|----------|--------|
| 2025-01-12 | v0.0.2 | 重新设计 PRD，完善用户场景和交互 | Claude |
| 2025-01-11 | v0.0.2 | 初始版本 | - |
