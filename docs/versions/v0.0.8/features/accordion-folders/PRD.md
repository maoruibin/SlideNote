# v0.0.8 手风琴文件夹功能 - 产品需求文档

> **版本**: v0.0.8
> **需求类型**: 新增功能
> **优先级**: P0
> **状态**: 设计中
> **日期**: 2025-01-21

---

## 一、需求背景

### 1.1 用户痛点

随着笔记数量增加，用户在列表中查找特定笔记变得困难。虽然搜索功能强大，但用户有「分类整理」的心理需求。

### 1.2 产品定位考虑

| 维度 | 考虑 |
|------|------|
| 产品定位 | 浏览器侧边的「便利贴」，不是笔记本软件 |
| 核心价值 | 快速存取碎片信息 |
| 设计原则 | 保持简单，不增加复杂度 |

**结论**：不引入复杂的层级结构，采用扁平化的「文件夹」分组方式。

---

## 二、需求描述

### 2.1 核心功能

用户可以创建文件夹，将笔记归类到不同文件夹中。文件夹采用手风琴折叠交互，类似 Windows 文件管理器。

### 2.2 非功能要求

- 文件夹数量不限，但建议不超过 10 个
- 笔记可以属于「未分类」（默认）
- 一个笔记只能属于一个文件夹
- 跨设备同步文件夹数据

---

## 三、交互设计

### 3.1 默认状态（无文件夹）

```
┌────────────────────────────┐
│  [+] 新建笔记      [收起]  │  ← Toolbar
├────────────────────────────┤
│ 📌 AI 提示词               │  ← 笔记列表
│   常用命令                 │
│   服务器地址               │
│   项目待办                 │
└────────────────────────────┘
```

### 3.2 有文件夹状态（展开）

```
┌────────────────────────────┐
│  [+] 新建笔记      [收起]  │
├────────────────────────────┤
│ ▼ 工作 (4)                 │  ← 文件夹展开状态
│   📌 AI 提示词             │
│   常用命令                 │
│   服务器地址               │
│   项目待办                 │
│ ▶ 生活 (2)                 │  ← 文件夹折叠状态
│ ▶ 学习 (1)                 │
│ ─────────────────────────  │  ← 分隔线
│   📌 未分类的笔记          │  ← 未分组笔记
│   其他随笔                 │
└────────────────────────────┘
```

### 3.3 图标说明

| 图标 | 含义 |
|------|------|
| ▼ (triangle-down) | 文件夹已展开 |
| ▶ (triangle-right) | 文件夹已折叠 |
| 📌 | 置顶的笔记 |

---

## 四、操作流程

### 4.1 创建文件夹

**方式一：从笔记右键菜单**
```
1. 右键笔记 → "移动到文件夹" → "新建文件夹"
2. 输入文件夹名称
3. 笔记自动移入新文件夹
```

**方式二：从列表头部**
```
1. 列表顶部 "+" 按钮 → "新建文件夹"
2. 输入文件夹名称
3. 创建空文件夹
```

### 4.2 移动笔记到文件夹

```
1. 右键笔记 → "移动到文件夹"
2. 选择目标文件夹（或"新建文件夹"）
3. 笔记移入，文件夹自动展开
```

### 4.3 展开/折叠文件夹

```
点击文件夹头部 → 切换展开/折叠状态
```

### 4.4 删除文件夹

```
1. 右键文件夹 → "删除文件夹"
2. 确认对话框
3. 文件夹删除，笔记移入"未分类"
```

### 4.5 重命名文件夹

```
1. 右键文件夹 → "重命名"
2. 输入新名称
```

---

## 五、数据结构设计

### 5.1 笔记对象扩展

```javascript
{
  id: "note_xxx",
  title: "标题",
  content: "内容",
  folderId: "folder_123",  // ← 新增：所属文件夹 ID
                               // null 或 undefined 表示未分类
  pinned: false,
  createdAt: 1234567890,
  updatedAt: 1234567890,
  order: 1
}
```

### 5.2 文件夹对象

```javascript
{
  id: "folder_xxx",
  name: "工作",
  createdAt: 1234567890,
  order: 1,  // 文件夹排序
  collapsed: false  // 折叠状态（本地存储）
}
```

### 5.3 Storage 结构

```javascript
// Chrome Storage Keys
{
  'slidenote_notes': [...],      // 笔记数组
  'slidenote_folders': [...],    // ← 新增：文件夹数组
  'slidenote_active_id': 'xxx',
  'slidenote_folder_states': {   // ← 新增：文件夹折叠状态
    'folder_123': false,         // false=展开, true=折叠
    'folder_456': true
  }
}
```

---

## 六、UI 设计规范

### 6.1 文件夹项样式

```
展开状态：
┌────────────────────────────┐
│ ▼ 工作 (4)          ... ⋮  │  ← 左侧三角形 + 名称 + 数量
├────────────────────────────┤  ← 分隔线（可选）
│   📌 AI 提示词             │
│   常用命令                 │
│   服务器地址               │
│   项目待办                 │
└────────────────────────────┘

折叠状态：
┌────────────────────────────┐
│ ▶ 工作 (4)          ... ⋮  │  ← 三角形向右
│ ▶ 生活 (2)          ... ⋮  │
└────────────────────────────┘
```

### 6.2 样式变量

```css
/* 文件夹头部 */
.folder-header {
  padding: var(--spacing-sm) var(--spacing-md);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  user-select: none;
}

.folder-header:hover {
  background-color: var(--color-bg-hover);
}

/* 展开/折叠图标 */
.folder-icon {
  width: 12px;
  height: 12px;
  transition: transform 0.2s;
}

.folder-icon.expanded {
  transform: rotate(90deg);
}

/* 文件夹名称 */
.folder-name {
  flex: 1;
  font-size: var(--font-size-sm);
  font-weight: 500;
}

/* 笔记数量 */
.folder-count {
  font-size: 11px;
  color: var(--color-text-secondary);
}

/* 文件夹内笔记缩进 */
.note-item.in-folder {
  padding-left: 24px;  /* 缩进显示层级 */
}

/* 未分类分隔线 */
.uncategorized-divider {
  border-top: 1px solid var(--color-border-light);
  margin: var(--spacing-sm) 0;
}
```

---

## 七、右键菜单设计

### 7.1 笔记右键菜单

```
┌────────────────────┐
│ 移动到顶部        │
│ 上移              │
│ 下移              │
│ 移动到底部        │
│ ──────────────────│
│ 移动到文件夹 >    │  ← 新增：子菜单
│   ├─ 工作         │
│   ├─ 生活         │
│   ├─ 学习         │
│   └─ + 新建文件夹 │
│ ──────────────────│
│ 📌 置顶           │
│ 删除              │
└────────────────────┘
```

### 7.2 文件夹右键菜单

```
┌────────────────────┐
│ 重命名            │
│ ──────────────────│
│ 删除文件夹        │
└────────────────────┘
```

---

## 八、边界情况处理

### 8.1 删除文件夹

| 情况 | 处理方式 |
|------|----------|
| 文件夹有笔记 | 笔记移入「未分类」 |
| 文件夹为空 | 直接删除 |
| 删除后笔记顺序 | 保持原有顺序 |

### 8.2 搜索状态

| 状态 | 显示方式 |
|------|----------|
| 搜索中 | 平铺显示所有匹配笔记，不分组 |
| 无搜索 | 按文件夹分组显示 |

### 8.3 置顶笔记

| 情况 | 显示方式 |
|------|----------|
| 置顶笔记在文件夹内 | 文件夹内排在最前 |
| 置顶笔记未分类 | 「未分类」区域排在最前 |

---

## 九、国际化文案

| Key | 中文 | English |
|-----|------|---------|
| newFolder | 新建文件夹 | New Folder |
| moveToFolder | 移动到文件夹 | Move to Folder |
| renameFolder | 重命名 | Rename |
| deleteFolder | 删除文件夹 | Delete Folder |
| deleteFolderConfirm | 删除文件夹「$1$」？笔记将移至未分类。 | Delete folder "$1$"? Notes will be moved to Uncategorized. |
| uncategorized | 未分类 | Uncategorized |
| emptyFolder | 空文件夹 | Empty folder |

---

## 十、实施计划

### 10.1 开发顺序

| 步骤 | 任务 | 预估工时 |
|------|------|----------|
| 1 | 数据结构设计（folderId, folders 数组） | 30min |
| 2 | Store.js 扩展（文件夹 CRUD 方法） | 2h |
| 3 | NoteList 组件改造（支持分组渲染） | 3h |
| 4 | 文件夹头部组件（展开/折叠交互） | 1.5h |
| 5 | 右键菜单扩展（移动到文件夹） | 1h |
| 6 | CSS 样式实现 | 1h |
| 7 | 国际化文案 | 30min |
| 8 | 测试与调试 | 1.5h |

**总计**：约 11 小时

### 10.2 验收标准

- [ ] 可创建/删除/重命名文件夹
- [ ] 可移动笔记到文件夹
- [ ] 点击文件夹头部展开/折叠
- [ ] 折叠状态持久化（刷新页面保持）
- [ ] 未分类笔记显示在底部
- [ ] 搜索时平铺显示所有笔记
- [ ] 文件夹数据跨设备同步
- [ ] 置顶笔记在文件夹内排序正确

---

> **设计原则**：符合 Windows 文件夹的常识认知，保持简洁，不影响核心的快速存取体验。
