# å¯¼èˆªæŒ‰é’®ç½®é¡¶ç¬”è®° Bug - äº§å“éœ€æ±‚æ–‡æ¡£

> **Bug ç¼–å·**: BUG-001
> **ç‰ˆæœ¬**: v0.0.8
> **æ—¥æœŸ**: 2025-01-24
> **çŠ¶æ€**: âœ… å·²ä¿®å¤
> **ä¼˜å…ˆçº§**: P1ï¼ˆé«˜ï¼‰

---

## ä¸€ã€Bug æè¿°

### 1.1 é—®é¢˜ç®€è¿°

å½“å­˜åœ¨ç½®é¡¶ç¬”è®°æ—¶ï¼Œæ™®é€šç¬”è®°çš„**å‘ä¸Šç®­å¤´æŒ‰é’®è¢«é”™è¯¯ç¦ç”¨**ï¼Œæ— æ³•å¯¼èˆªåˆ°ç½®é¡¶ç¬”è®°ã€‚

### 1.2 å¤ç°æ­¥éª¤

1. åˆ›å»ºè‡³å°‘ 2 æ¡ç¬”è®°
2. å°†å…¶ä¸­ 1 æ¡ç¬”è®°ç½®é¡¶
3. ç‚¹å‡»é€‰æ‹©ä¸€æ¡**æ™®é€šç¬”è®°ï¼ˆéç½®é¡¶ï¼‰**
4. æŸ¥çœ‹ç¼–è¾‘å™¨é¡¶éƒ¨çš„**å‘ä¸Šç®­å¤´æŒ‰é’®**

### 1.3 é¢„æœŸè¡Œä¸º

- å‘ä¸Šç®­å¤´åº”è¯¥**å¯ç‚¹å‡»**
- ç‚¹å‡»ååº”å¯¼èˆªåˆ°ä¸Šä¸€æ¡ç¬”è®°ï¼ˆåŒ…æ‹¬ç½®é¡¶ç¬”è®°ï¼‰

### 1.4 å®é™…è¡Œä¸º

- å‘ä¸Šç®­å¤´è¢«**ç¦ç”¨ï¼ˆç°è‰²ï¼‰**
- æ— æ³•å‘ä¸Šå¯¼èˆªåˆ°ç½®é¡¶ç¬”è®°

### 1.5 å½±å“èŒƒå›´

| å½±å“é¡¹ | è¯´æ˜ |
|--------|------|
| åŠŸèƒ½ | ç¬”è®°é—´å¯¼èˆªåŠŸèƒ½ |
| ç”¨æˆ· | æ‰€æœ‰ä½¿ç”¨ç½®é¡¶åŠŸèƒ½çš„ç”¨æˆ· |
| åœºæ™¯ | æœ‰ç½®é¡¶ç¬”è®°æ—¶ï¼Œæ™®é€šç¬”è®°æ— æ³•å‘ä¸Šå¯¼èˆª |

---

## äºŒã€åœºæ™¯ç¤ºä¾‹

```
ç¬”è®°åˆ—è¡¨ï¼ˆæŒ‰ç½®é¡¶æ’åºï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Œ ç½®é¡¶ç¬”è®° A                â”‚ â† ç´¢å¼• 0
â”‚ ğŸ“Œ ç½®é¡¶ç¬”è®° B                â”‚ â† ç´¢å¼• 1
â”‚   æ™®é€šç¬”è®° C                 â”‚ â† ç´¢å¼• 2
â”‚   æ™®é€šç¬”è®° D                 â”‚ â† ç´¢å¼• 3
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æ“ä½œï¼šé€‰æ‹© "æ™®é€šç¬”è®° C"
é¢„æœŸç»“æœï¼šå‘ä¸Šç®­å¤´å¯ç”¨ï¼Œå¯å¯¼èˆªåˆ° "ç½®é¡¶ç¬”è®° B"
å®é™…ç»“æœï¼šå‘ä¸Šç®­å¤´è¢«ç¦ç”¨ âŒ
```

---

## ä¸‰ã€æ ¹æœ¬åŸå› åˆ†æ

### 3.1 é—®é¢˜ä»£ç 

**æ–‡ä»¶**: `src/sidepanel/components/NoteEditor.js`

**ä½ç½®**: ç¬¬ 127-130 è¡Œï¼ˆ`_renderHeader` æ–¹æ³•ï¼‰

```javascript
// âŒ é—®é¢˜ä»£ç 
const notes = this.props.store?.state.notes || [];  // ä½¿ç”¨åŸå§‹é¡ºåºï¼
const currentIndex = notes.findIndex(n => n.id === this.state.note?.id);
const isFirst = currentIndex <= 0;
const isLast = currentIndex >= notes.length - 1;
```

### 3.2 åŸå› åˆ†æ

```
åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€ vs å¯¼èˆªé€»è¾‘ ä¸ä¸€è‡´

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆå§‹åŒ–æŒ‰é’®ï¼ˆ_renderHeaderï¼‰                         â”‚
â”‚  â””â”€â”€ ä½¿ç”¨ï¼šstate.notesï¼ˆåŸå§‹é¡ºåºï¼‰                   â”‚
â”‚      â†’ æ™®é€šç¬”è®°åœ¨åŸå§‹åˆ—è¡¨ä¸­å¯èƒ½æ˜¯ç¬¬ä¸€ä¸ª              â”‚
â”‚      â†’ isFirst = trueï¼Œå‘ä¸Šç®­å¤´è¢«ç¦ç”¨ âŒ            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¼èˆªåŠŸèƒ½ï¼ˆ_navigateToPrevï¼‰                          â”‚
â”‚  â””â”€â”€ ä½¿ç”¨ï¼šgetSortedNotes()ï¼ˆç½®é¡¶æ’åºï¼‰              â”‚
â”‚      â†’ æ™®é€šç¬”è®°ä¸åœ¨ç¬¬ä¸€ä¸ªä½ç½®                        â”‚
â”‚      â†’ åº”è¯¥èƒ½å‘ä¸Šå¯¼èˆª âœ…                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 æ•°æ®ç¤ºä¾‹

```javascript
// åŸå§‹é¡ºåº state.notes
[
  { id: 'note-1', title: 'æ™®é€šç¬”è®°C', pinned: false },  // åŸå§‹ç´¢å¼• 0
  { id: 'note-2', title: 'ç½®é¡¶ç¬”è®°A', pinned: true },  // åŸå§‹ç´¢å¼• 1
  { id: 'note-3', title: 'æ™®é€šç¬”è®°D', pinned: false }, // åŸå§‹ç´¢å¼• 2
]

// getSortedNotes() è¿”å›é¡ºåº
[
  { id: 'note-2', title: 'ç½®é¡¶ç¬”è®°A', pinned: true },  // æ’åºç´¢å¼• 0
  { id: 'note-1', title: 'æ™®é€šç¬”è®°C', pinned: false }, // æ’åºç´¢å¼• 1
  { id: 'note-3', title: 'æ™®é€šç¬”è®°D', pinned: false }, // æ’åºç´¢å¼• 2
]

// å½“é€‰æ‹© "æ™®é€šç¬”è®°C" æ—¶ï¼š
// åŸå§‹ç´¢å¼• = 0 â†’ isFirst = true â†’ å‘ä¸Šç®­å¤´è¢«ç¦ç”¨ âŒ
// æ’åºç´¢å¼• = 1 â†’ ä¸æ˜¯ç¬¬ä¸€ä¸ª â†’ å‘ä¸Šç®­å¤´åº”è¯¥å¯ç”¨ âœ…
```

---

## å››ã€ä¿®å¤æ–¹æ¡ˆ

### 4.1 ç›®æ ‡

ç»Ÿä¸€ä½¿ç”¨ `getSortedNotes()` æ–¹æ³•ï¼Œç¡®ä¿æŒ‰é’®çŠ¶æ€ä¸å®é™…å¯¼èˆªé€»è¾‘ä¸€è‡´ã€‚

### 4.2 ä¿®æ”¹æ–¹æ¡ˆ

**æ–‡ä»¶**: `src/sidepanel/components/NoteEditor.js`

**ä¿®æ”¹ä½ç½®**: `_renderHeader` æ–¹æ³•ï¼Œç¬¬ 127-130 è¡Œ

**ä¿®æ”¹å‰**ï¼š
```javascript
const notes = this.props.store?.state.notes || [];
const currentIndex = notes.findIndex(n => n.id === this.state.note?.id);
const isFirst = currentIndex <= 0;
const isLast = currentIndex >= notes.length - 1;
```

**ä¿®æ”¹å**ï¼š
```javascript
const notes = this.props.store?.getSortedNotes() || [];  // âœ… ä½¿ç”¨æ’åºåçš„é¡ºåº
const currentIndex = notes.findIndex(n => n.id === this.state.note?.id);
const isFirst = currentIndex <= 0;
const isLast = currentIndex >= notes.length - 1;
```

### 4.3 éªŒè¯æ–¹æ³•

| æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ |
|----------|----------|
| æœ‰ç½®é¡¶ç¬”è®°æ—¶ï¼Œé€‰æ‹©æ™®é€šç¬”è®° | å‘ä¸Šç®­å¤´å¯ç”¨ |
| ç‚¹å‡»å‘ä¸Šç®­å¤´ | æ­£ç¡®å¯¼èˆªåˆ°ç½®é¡¶ç¬”è®° |
| ç¬¬ä¸€æ¡ç¬”è®°ï¼ˆç½®é¡¶ï¼‰ | å‘ä¸Šç®­å¤´ç¦ç”¨ |
| æœ€åä¸€æ¡ç¬”è®° | å‘ä¸‹ç®­å¤´ç¦ç”¨ |

---

## äº”ã€éªŒæ”¶æ ‡å‡†

- [ ] æ™®é€šç¬”è®°å¯ä»¥å‘ä¸Šå¯¼èˆªåˆ°ç½®é¡¶ç¬”è®°
- [ ] ç¬¬ä¸€æ¡ç¬”è®°çš„å‘ä¸Šç®­å¤´æ­£ç¡®ç¦ç”¨
- [ ] æœ€åä¸€æ¡ç¬”è®°çš„å‘ä¸‹ç®­å¤´æ­£ç¡®ç¦ç”¨
- [ ] å¯¼èˆªé¡ºåºä¸ç¬”è®°åˆ—è¡¨æ˜¾ç¤ºé¡ºåºä¸€è‡´
- [ ] æ— æ§åˆ¶å°é”™è¯¯

---

## å…­ã€ç›¸å…³æ–‡æ¡£

- **æŠ€æœ¯å®ç°**: ç½®é¡¶åŠŸèƒ½æŠ€æœ¯æ–‡æ¡£
- **ç›¸å…³ä»£ç **: `src/sidepanel/core/Store.js` (getSortedNotes)
- **ç›¸å…³ä»£ç **: `src/sidepanel/components/NoteEditor.js`

---

## ä¸ƒã€å˜æ›´å†å²

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´è¯´æ˜ |
|------|------|----------|
| 2025-01-24 | v0.0.8 | åˆå§‹è®°å½•ï¼Œå·²å®Œæˆæ ¹å› åˆ†æ |
| 2025-01-24 | v0.0.8 | å·²ä¿®å¤ï¼šå°† `state.notes` æ”¹ä¸º `getSortedNotes()` |

---

> **å¤‡æ³¨**: æ­¤ Bug å·²ä¿®å¤ âœ…
